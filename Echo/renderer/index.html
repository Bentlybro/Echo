<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="player-controls.css">
    <link rel="stylesheet" href="equalizer.css">
    <script src="../assets/icons/icon-loader.js"></script>
</head>
<body>
    <!-- Custom Title Bar -->
    <div class="title-bar">
        <div class="title-bar-drag-region">
            <div class="title-bar-title">
                <i data-lucide="music" class="title-bar-icon"></i>
                <span class="title-text">Echo</span>
            </div>
        </div>
        <div class="title-bar-controls">
            <button class="title-bar-btn" id="minimize-btn" title="Minimize">
                <i data-lucide="minus"></i>
            </button>
            <button class="title-bar-btn" id="maximize-btn" title="Maximize">
                <i data-lucide="square"></i>
            </button>
            <button class="title-bar-btn close-btn" id="close-btn" title="Close">
                <i data-lucide="x"></i>
            </button>
        </div>
    </div>
    
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="app-title">Echo</h1>
            <div class="header-search">
                <div class="search-container">
                    <i data-lucide="search" class="search-icon"></i>
                    <input type="text" id="search-input" class="search-input" placeholder="Search songs, artists, albums...">
                    <button id="clear-search-btn" class="clear-search-btn" title="Clear search">
                        <i data-lucide="x"></i>
                    </button>
                </div>
            </div>
            <div class="header-controls">
                <button id="add-music-btn" class="btn btn-secondary">Add Music</button>
                <button id="create-playlist-btn" class="btn btn-secondary">New Playlist</button>
                <button id="manage-folders-btn" class="btn btn-secondary">Import Folders</button>
                <button id="settings-btn" class="btn btn-secondary" title="Settings">
                    <i data-lucide="settings"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>Library</h3>
                    <ul class="sidebar-nav">
                        <li><a href="#" class="nav-item active" data-view="all-songs">All Songs</a></li>
                        <li><a href="#" class="nav-item" data-view="liked-songs">
                            <i data-lucide="heart"></i>
                            Liked Songs
                        </a></li>
                        <li><a href="#" class="nav-item" data-view="recently-played">
                            <i data-lucide="clock"></i>
                            Recently Played
                        </a></li>
                        <li><a href="#" class="nav-item" data-view="equalizer">
                            <i data-lucide="sliders"></i>
                            Equalizer
                        </a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>Smart Playlists</h3>
                    <ul class="sidebar-nav">
                        <li><a href="#" class="nav-item" data-view="recently-added">
                            <i data-lucide="plus-circle"></i>
                            Recently Added
                        </a></li>
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>Playlists</h3>
                    <ul id="playlists-list" class="sidebar-nav">
                        <!-- Playlists will be loaded here -->
                    </ul>
                </div>
            </aside>

            <!-- Content Area -->
            <main class="content">
                <!-- Drop Zone -->
                <div id="drop-zone" class="drop-zone">
                    <div class="drop-zone-content">
                        <div class="drop-icon"></div>
                        <p>Drag and drop music files here</p>
                        <p class="drop-hint">or use the "Add Music" button</p>
                    </div>
                </div>

                <!-- Song List -->
                <div id="song-list-container" class="song-list-container">
                    <div class="list-header">
                        <div class="list-title">
                            <h2 id="current-view-title">All Songs</h2>
                            <span id="song-count" class="song-count">0 songs</span>
                        </div>
                        <div class="list-controls">
                            <button id="play-all-btn" class="btn btn-primary">Play All</button>
                        </div>
                    </div>
                    
                    <div class="song-list-header">
                        <span class="col-select"></span>
                        <span class="col-thumbnail"></span>
                        <span class="col-info">Song</span>
                        <span class="col-album">Album</span>
                        <span class="col-duration">Duration</span>
                        <span class="col-actions">♡</span>
                    </div>
                    
                    <div id="song-list" class="song-list">
                        <!-- Songs will be loaded here -->
                    </div>
                </div>

                <!-- Equalizer & Stats Page -->
                <div id="equalizer-container" class="equalizer-container" style="display: none;">
                    <div class="eq-header">
                        <h2>Equalizer</h2>
                        <p>Customize your audio experience</p>
                    </div>

                    <div class="eq-content">
                        <div class="eq-section">
                            <h3>Equalizer</h3>
                            <div class="eq-controls">
                                <div class="eq-presets">
                                    <select id="eq-preset" class="eq-preset-selector">
                                        <option value="flat">Flat</option>
                                        <option value="rock">Rock</option>
                                        <option value="pop">Pop</option>
                                        <option value="jazz">Jazz</option>
                                        <option value="classical">Classical</option>
                                        <option value="electronic">Electronic</option>
                                        <option value="bass-boost">Bass Boost</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                                
                                <div class="eq-sliders">
                                    <div class="eq-band">
                                        <label>60Hz</label>
                                        <input type="range" class="eq-slider" id="eq-60" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>170Hz</label>
                                        <input type="range" class="eq-slider" id="eq-170" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>310Hz</label>
                                        <input type="range" class="eq-slider" id="eq-310" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>600Hz</label>
                                        <input type="range" class="eq-slider" id="eq-600" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>1kHz</label>
                                        <input type="range" class="eq-slider" id="eq-1000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>3kHz</label>
                                        <input type="range" class="eq-slider" id="eq-3000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>6kHz</label>
                                        <input type="range" class="eq-slider" id="eq-6000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>12kHz</label>
                                        <input type="range" class="eq-slider" id="eq-12000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>14kHz</label>
                                        <input type="range" class="eq-slider" id="eq-14000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                    <div class="eq-band">
                                        <label>16kHz</label>
                                        <input type="range" class="eq-slider" id="eq-6000" min="-20" max="20" value="0" step="1">
                                        <span class="eq-value">0dB</span>
                                    </div>
                                </div>
                                
                                <div class="eq-actions">
                                    <button id="eq-reset" class="btn btn-secondary">Reset</button>
                                    <button id="eq-enable" class="btn btn-primary">Enable EQ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Player Controls -->
        <footer class="player-controls">
            <div class="now-playing">
                <div class="album-art">
                    <div class="album-placeholder"></div>
                </div>
                <div class="track-info">
                    <div id="current-title" class="track-title">No song selected</div>
                    <div id="current-artist" class="track-artist">-</div>
                </div>
            </div>

            <div class="controls">
                <button id="shuffle-btn" class="control-btn" title="Shuffle">
                    <i data-lucide="shuffle"></i>
                </button>
                <button id="like-current-btn" class="control-btn like-btn" title="Like current song">
                    <i data-lucide="heart"></i>
                </button>
                <button id="history-btn" class="control-btn" title="Show playback history">
                    <i data-lucide="history"></i>
                </button>
                <button id="prev-btn" class="control-btn">
                    <i data-lucide="skip-back"></i>
                </button>
                <button id="play-pause-btn" class="control-btn play-btn">
                    <i data-lucide="play"></i>
                </button>
                <button id="next-btn" class="control-btn">
                    <i data-lucide="skip-forward"></i>
                </button>
            </div>

            <div class="progress-container">
                <span id="current-time" class="time">0:00</span>
                <div class="progress-bar-container">
                    <div class="progress-bar-track">
                        <div id="progress-bar-fill" class="progress-bar-fill"></div>
                    </div>
                    <div id="progress-bar-thumb" class="progress-bar-thumb"></div>
                </div>
                <span id="total-time" class="time">0:00</span>
            </div>

            <div class="volume-container">
                <button id="mute-btn" class="control-btn">
                    <i data-lucide="volume-2"></i>
                </button>
                <input type="range" id="volume-bar" class="volume-bar" min="0" max="100" value="100">
                <span id="volume-percentage" class="volume-percentage">100%</span>
            </div>
        </footer>
    </div>

    <!-- Hidden audio element -->
    <audio id="audio-player" preload="metadata"></audio>

    <!-- Modal for creating playlists -->
    <div id="playlist-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Playlist</h3>
                <button class="modal-close"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="playlist-name-input" placeholder="Playlist name" maxlength="50">
            </div>
            <div class="modal-footer">
                <button id="cancel-playlist-btn" class="btn btn-secondary">Cancel</button>
                <button id="create-playlist-confirm-btn" class="btn btn-primary">Create</button>
            </div>
        </div>
    </div>

    <!-- Modal for managing watched folders -->
    <div id="folders-modal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h3>Import Folders</h3>
                <button class="modal-close" id="folders-modal-close"></button>
            </div>
            <div class="modal-body">
                <div class="folders-section">
                    <div class="section-header">
                        <h4>Watched Folders</h4>
                        <button id="add-folder-from-modal-btn" class="btn btn-primary btn-small">Add Folder</button>
                    </div>
                    <p class="section-description">Folders are automatically monitored for new music files</p>
                    <div id="watched-folders-list" class="watched-folders">
                        <!-- Watched folders will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-folders-btn" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" id="settings-modal-close">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="appearance">
                        <i data-lucide="palette"></i>
                        Appearance
                    </button>
                    <button class="settings-tab" data-tab="playback">
                        <i data-lucide="play"></i>
                        Playback
                    </button>
                    <button class="settings-tab" data-tab="general">
                        <i data-lucide="settings"></i>
                        General
                    </button>
                </div>
                
                <div class="settings-content">
                    <!-- Appearance Tab -->
                    <div class="settings-tab-content active" data-tab-content="appearance">
                        <div class="settings-section">
                            <h4>Color Theme</h4>
                            <p class="settings-description">Customize the colors of your music player</p>
                            
                            <div class="color-settings">
                                <div class="color-setting">
                                    <label for="primary-bg-color">Background</label>
                                    <div class="color-input-group">
                                        <input type="color" id="primary-bg-color" value="#000000">
                                        <input type="text" id="primary-bg-text" value="#000000" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="color-setting">
                                    <label for="accent-color">Accent Color</label>
                                    <div class="color-input-group">
                                        <input type="color" id="accent-color-picker" value="#667eea">
                                        <input type="text" id="accent-color-text" value="#667eea" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="color-setting">
                                    <label for="text-color">Text Color</label>
                                    <div class="color-input-group">
                                        <input type="color" id="text-color-picker" value="#ffffff">
                                        <input type="text" id="text-color-text" value="#ffffff" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="color-setting">
                                    <label for="border-color">Border Color</label>
                                    <div class="color-input-group">
                                        <input type="color" id="border-color-picker" value="#333333">
                                        <input type="text" id="border-color-text" value="#333333" maxlength="7">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="theme-presets">
                                <h5>Quick Themes</h5>
                                <div class="preset-buttons">
                                    <button class="preset-btn" data-theme="default">Default</button>
                                    <button class="preset-btn" data-theme="dark-blue">Dark Blue</button>
                                    <button class="preset-btn" data-theme="purple">Purple</button>
                                    <button class="preset-btn" data-theme="dark-pink">Dark Pink</button>
                                    <button class="preset-btn" data-theme="green">Green</button>
                                    <button class="preset-btn" data-theme="red">Red</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Playback Tab -->
                    <div class="settings-tab-content" data-tab-content="playback">
                        <div class="settings-section">
                            <h4>Audio Settings</h4>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="crossfade-enabled">
                                    Enable crossfade between tracks
                                </label>
                            </div>
                            <div class="setting-item crossfade-duration" id="crossfade-duration-setting" style="display: none;">
                                <label for="crossfade-duration">Crossfade Duration</label>
                                <div class="slider-container">
                                    <input type="range" id="crossfade-duration" min="1" max="10" value="3" step="1">
                                    <span id="crossfade-duration-value">3 seconds</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- General Tab -->
                    <div class="settings-tab-content" data-tab-content="general">
                        <div class="settings-section">
                            <h4>Application Settings</h4>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" id="minimize-to-tray">
                                    Minimize to system tray
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4>About</h4>
                            <div class="setting-item">
                                <p><strong>Echo Music Player</strong></p>
                                <p>Version: <span id="app-version">Loading...</span></p>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h4>Updates</h4>
                            <div class="setting-item">
                                <button id="check-updates-btn" class="btn btn-secondary">
                                    <i data-lucide="download"></i>
                                    Check for Updates
                                </button>
                                <button id="show-update-history-btn" class="btn btn-secondary">
                                    <i data-lucide="clock"></i>
                                    Update History
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="reset-settings-btn" class="btn btn-secondary">Reset to Default</button>
                <button id="close-settings-btn" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="song-context-menu" class="context-menu">
        <!-- Single song options -->
        <div class="single-song-options">
            <div class="context-menu-item" id="context-play-song">
                <i data-lucide="play"></i>
                <span id="context-play-text">Play Song</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="context-play-next">
                <i data-lucide="skip-forward"></i>
                <span id="context-play-next-text">Play Next</span>
            </div>
            <div class="context-menu-item" id="context-add-to-queue">
                <i data-lucide="list-plus"></i>
                <span id="context-add-queue-text">Add to Queue</span>
            </div>
        </div>
        
        <!-- Multi-song options -->
        <div class="multi-song-options" style="display: none;">
            <div class="context-menu-item" id="context-add-selected-to-queue">
                <i data-lucide="list-plus"></i>
                <span id="context-add-selected-queue-text">Add Selected to Queue</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="context-deselect-all">
                <i data-lucide="x"></i>
                <span>Deselect All</span>
            </div>
        </div>

        <!-- Common options for both single and multiple -->
        <div class="context-menu-item submenu-parent" id="context-add-to-playlist">
            <i data-lucide="folder-plus"></i>
            <span id="context-add-playlist-text">Add to Playlist</span>
            <i data-lucide="chevron-right" class="submenu-arrow"></i>
            <div class="context-submenu" id="playlist-submenu">
                <!-- Playlists will be populated dynamically -->
            </div>
        </div>
        
        <!-- Single song only options -->
        <div class="single-song-only">
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="context-search-artist">
                <i data-lucide="user"></i>
                Search all by <span id="context-artist-name">Artist</span>
            </div>
            <div class="context-menu-item" id="context-search-album">
                <i data-lucide="disc"></i>
                Search all by <span id="context-album-name">Album</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" id="context-like-song">
                <i data-lucide="heart"></i>
                <span id="context-like-text">Like Song</span>
            </div>
        </div>
        
        <!-- Delete option for both -->
        <div class="context-menu-separator"></div>
        <div class="context-menu-item danger" id="context-delete-song">
            <i data-lucide="trash-2"></i>
            <span id="context-delete-text">Delete from Library</span>
        </div>
    </div>

    <!-- Playlist Settings Modal -->
    <div id="playlist-settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Playlist Settings</h3>
                <button class="modal-close" id="playlist-settings-modal-close"></button>
            </div>
            <div class="modal-body">
                <div class="playlist-settings-section">
                    <h4 id="current-playlist-name">Playlist Name</h4>
                    <div class="form-group">
                        <label for="playlist-rename-input">Rename Playlist</label>
                        <input type="text" id="playlist-rename-input" class="form-input" placeholder="Enter new playlist name">
                        <button id="rename-playlist-btn" class="btn btn-primary">Rename</button>
                    </div>
                </div>
                
                <div class="playlist-settings-section">
                    <h4>Danger Zone</h4>
                    <p class="danger-warning">Deleting a playlist cannot be undone.</p>
                    <button id="delete-playlist-btn" class="btn btn-danger">Delete Playlist</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Bulk import progress -->
    <div id="bulk-import-progress" class="bulk-import-progress">
        <div class="progress-header">
            <span id="progress-title">Importing music files...</span>
            <button id="progress-close" class="progress-close">×</button>
        </div>
        <div class="progress-bar-wrapper">
            <div id="import-progress-bar" class="import-progress-bar"></div>
        </div>
        <div class="progress-stats">
            <span id="progress-text">Processing files...</span>
            <span id="progress-numbers">0 / 0</span>
        </div>
    </div>

    <!-- Playback History Popup -->
    <div id="history-popup" class="history-popup">
        <div class="history-header">
            <h3>Playback History</h3>
            <button id="close-history-btn" class="close-btn">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="history-content">
            <div id="history-list" class="history-list">
                <div class="history-empty">
                    <i data-lucide="clock"></i>
                    <p>No playback history yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Notification Popup -->
    <div id="update-notification" class="update-notification">
        <div class="update-header">
            <div class="update-icon">
                <i data-lucide="download"></i>
            </div>
            <div class="update-title">
                <h4>Update Available</h4>
                <p>Echo <span id="update-version">1.1.0</span> is ready to install</p>
            </div>
            <button id="close-update-btn" class="update-close-btn">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="update-content">
            <div class="update-info">
                <div class="update-detail">
                    <span class="update-label">Released:</span>
                    <span id="update-date">Today</span>
                </div>
                <div class="update-detail">
                    <span class="update-label">Size:</span>
                    <span id="update-size">~45 MB</span>
                </div>
            </div>
            <div class="update-changelog">
                <p id="update-summary">New features and improvements</p>
            </div>
        </div>
        <div class="update-actions">
            <button id="update-later-btn" class="update-btn update-btn-secondary">Later</button>
            <button id="update-skip-btn" class="update-btn update-btn-text">Skip This Version</button>
            <button id="update-install-btn" class="update-btn update-btn-primary">Install Update</button>
        </div>
        <div class="update-footer">
            <button id="update-history-btn" class="update-link">
                <i data-lucide="clock"></i>
                View Update History
            </button>
        </div>
    </div>

    <!-- Update History Modal -->
    <div id="update-history-modal" class="modal">
        <div class="modal-content update-history-content">
            <div class="modal-header">
                <h3>Update History</h3>
                <button id="close-history-modal-btn" class="close-btn">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="current-version">
                    <div class="version-badge current">
                        <i data-lucide="check-circle"></i>
                        <span>Current Version</span>
                    </div>
                    <div class="version-info">
                        <h4 id="current-version-number">v1.0.0</h4>
                        <p>You're running this version</p>
                    </div>
                </div>
                <div id="version-history" class="version-history">
                    <!-- Version history will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Update Download Progress -->
    <div id="update-progress" class="update-progress">
        <div class="progress-content">
            <div class="progress-icon">
                <i data-lucide="download"></i>
            </div>
            <div class="progress-info">
                <h4>Downloading Update</h4>
                <p id="progress-text">Preparing download...</p>
            </div>
        </div>
        <div class="progress-bar-container">
            <div id="download-progress-bar" class="progress-bar"></div>
        </div>
    </div>

    <!-- Utility scripts -->
    <script src="../src/renderer/utils/formatters.js"></script>
    
    <!-- Service scripts -->
    <script src="../src/renderer/services/NotificationService.js"></script>
    <script src="../src/renderer/services/ProgressService.js"></script>
    
    <!-- Component scripts -->
    <script src="../src/renderer/components/TitleBarManager.js"></script>
    <script src="../src/renderer/components/SongRenderer.js"></script>
    <script src="../src/renderer/components/PlaylistManager.js"></script>
    <script src="../src/renderer/components/FolderManager.js"></script>
    <script src="../src/renderer/components/DragDropHandler.js"></script>
    <script src="../src/renderer/components/SettingsManager.js"></script>
    <script src="../src/renderer/components/UpdateManager.js"></script>
    <script src="../src/renderer/components/EqualizerManager.js"></script>
    <script src="../src/renderer/components/AudioPlayer.js"></script>
    
    <!-- Main scripts -->
    <script src="../src/renderer/MusicPlayer.js"></script>
    
    <!-- Initialize app -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize local icons
            window.localIcons.createIcons();
            
            // Initialize title bar
            window.titleBarManager = new TitleBarManager();
            
            // Initialize music player
            window.musicPlayer = new MusicPlayer();
        });
    </script>
</body>
</html>